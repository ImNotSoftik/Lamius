From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: ruViolence <78062896+ruViolence@users.noreply.github.com>
Date: Sat, 4 Jun 2022 00:19:58 +0500
Subject: [PATCH] feat: configurable villagers


diff --git a/src/main/java/this/core/lamius/Lamius/LamiusConfig.java b/src/main/java/this/core/lamius/Lamius/LamiusConfig.java
index a59d750229e63810e2efce175d087de392cacfe8..c061c98b809c6f99f00a2db0cb10a2d9aeee8548 100644
--- a/src/main/java/this/core/lamius/Lamius/LamiusConfig.java
+++ b/src/main/java/this/core/lamius/Lamius/LamiusConfig.java
@@ -234,4 +234,9 @@ public class LamiusConfig {
             LamiusLightingQueue.processQueueAnyway();
         }
     }
+
+    public static boolean disableVillages;
+    private static void disableVillages() {
+        disableVillages = getBoolean("disable-villages", false);
+    }
 }
diff --git a/src/main/java/net/minecraft/server/PersistentVillage.java b/src/main/java/net/minecraft/server/PersistentVillage.java
index a3aa9f82e60a4fc4e90c5a46e37b05e7e3a0b31f..8290d50e12356b88fe090c7750c5fb70cb7718ee 100644
--- a/src/main/java/net/minecraft/server/PersistentVillage.java
+++ b/src/main/java/net/minecraft/server/PersistentVillage.java
@@ -21,6 +21,13 @@ public class PersistentVillage extends PersistentBase {
         super(a(world.worldProvider));
         this.world = world;
         this.c();
+        // Lamius start
+        if (this.core.lamius.Lamius.LamiusConfig.disableVillages) {
+            ((java.util.ArrayList<?>) c).trimToSize();
+            ((java.util.ArrayList<?>) d).trimToSize();
+            ((java.util.ArrayList<?>) villages).trimToSize();
+        }
+        // Lamius end
     }
 
     public void a(World world) {
@@ -36,6 +43,7 @@ public class PersistentVillage extends PersistentBase {
     }
 
     public void a(BlockPosition blockposition) {
+        if (this.core.lamius.Lamius.LamiusConfig.disableVillages) return; // Lamius
         if (this.c.size() <= 64) {
             if (!this.e(blockposition)) {
                 this.c.add(blockposition);
@@ -82,6 +90,7 @@ public class PersistentVillage extends PersistentBase {
     }
 
     public Village getClosestVillage(BlockPosition blockposition, int i) {
+        if (this.core.lamius.Lamius.LamiusConfig.disableVillages) return null; // Lamius
         Village village = null;
         double d0 = 3.4028234663852886E38D;
         Iterator iterator = this.villages.iterator();
@@ -238,6 +247,7 @@ public class PersistentVillage extends PersistentBase {
     }
 
     public void a(NBTTagCompound nbttagcompound) {
+        if (this.core.lamius.Lamius.LamiusConfig.disableVillages) return; // Lamius
         this.time = nbttagcompound.getInt("Tick");
         NBTTagList nbttaglist = nbttagcompound.getList("Villages", 10);
 
diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index bae37c9f3ea9e12d208768f7d3311f89058f2d22..c9c9fcff9eba61d2f943ddb625a0b0b60be17e04 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -338,10 +338,12 @@ public class WorldServer extends World implements IAsyncTaskHandler {
         this.manager.flush();
         timings.doChunkMap.stopTiming(); // Spigot
         // this.methodProfiler.c("village"); // Lamius - Remove MethodProfiler
+        if (!this.core.lamius.Lamius.LamiusConfig.disableVillages) { // Lamius
         timings.doVillages.startTiming(); // Spigot
         this.villages.tick();
         if (paperConfig.villageSiegesEnabled) { this.siegeManager.a(); } // Paper - Allow disabling village sieges
         timings.doVillages.stopTiming(); // Spigot
+        } // Lamius
         // this.methodProfiler.c("portalForcer"); // Lamius - Remove MethodProfiler
         timings.doPortalForcer.startTiming(); // Spigot
         this.portalTravelAgent.a(this.getTime());
